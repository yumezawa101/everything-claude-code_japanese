---
description: コミットされていない変更に対してセキュリティと品質の包括的レビューを実行します。
---

# Code Review

コミットされていない変更に対する包括的なセキュリティと品質レビュー：

## ステップ 1: 変更の把握

```bash
git diff --stat HEAD        # 変更概要（ファイル数、行数）
git diff --name-only HEAD   # 変更ファイル一覧
```

変更の規模と影響範囲を最初に把握する。

## ステップ 2: ファイルタイプ別レビュー

各変更ファイルについて、ファイルタイプに応じたチェックを適用：

**全ファイル共通:**
- ハードコードされた認証情報、APIキー、トークン
- console.log 文（デバッグ用の残留）
- TODO/FIXME コメント（チケット番号なし）

**TypeScript/JavaScript (.ts, .tsx, .js, .jsx):**
- `any` 型の乱用
- 未処理の Promise（`.catch()` や try/catch の欠如）
- `==` の使用（`===` を使うべき）
- イベントリスナーやタイマーの未解放
- 50行を超える関数
- 4レベルを超えるネスト深度

**React コンポーネント (.tsx, .jsx):**
- リスト要素の key prop 欠如
- useEffect の依存配列の不備
- 不要な再レンダリング（メモ化の欠如）
- アクセシビリティの問題（ARIA ラベル、alt 属性）

**API/サーバーコード:**
- 入力バリデーションの欠如
- SQL インジェクションの脆弱性
- 認証/認可チェックの欠如
- レート制限の欠如
- CORS 設定の不備

**設定ファイル (.env, .json, .yaml):**
- シークレットの平文保存
- 安全でないデフォルト値
- 本番環境でのデバッグモード有効化

## ステップ 3: セキュリティ重点チェック

変更に以下が含まれる場合、特に注意深くレビュー：
- ユーザー入力を受け付けるコード → インジェクション、XSS
- 認証/認可ロジック → バイパス、権限昇格
- ファイル操作 → パストラバーサル
- 外部 URL アクセス → SSRF
- データシリアライゼーション → プロトタイプ汚染

## ステップ 4: レポート生成

各問題について以下を含むレポートを出力：
- 重大度: CRITICAL、HIGH、MEDIUM、LOW
- ファイルの場所と行番号
- 問題の説明
- 修正案（コード例つき）

最後にサマリーテーブルを出力：

```
| 重大度 | 件数 |
|--------|------|
| CRITICAL | X |
| HIGH | X |
| MEDIUM | X |
| LOW | X |

判定: ✅ 承認 / ⚠️ 警告 / ❌ ブロック
```

## ステップ 5: 判定

- ✅ 承認: CRITICAL・HIGH の問題なし
- ⚠️ 警告: MEDIUM の問題のみ（注意してマージ可）
- ❌ ブロック: CRITICAL・HIGH の問題あり → コミット前に修正必須

セキュリティ脆弱性のあるコードを承認しないこと！
